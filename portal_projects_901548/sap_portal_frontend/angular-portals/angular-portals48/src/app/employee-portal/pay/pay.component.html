<div class="pay-container">
  <!-- Header Section -->
  <div class="pay-header">
    <div class="header-content">
      <h2>
        <i class="fas fa-money-check-alt header-icon"></i>
        Payroll & Benefits
      </h2>
      <p>View your salary details and download payslip documents</p>
    </div>
    <div class="header-actions">
      <button class="refresh-btn" (click)="refreshPayData()" [disabled]="isLoading">
        <i class="fas fa-sync-alt refresh-icon" [class.spinning]="isLoading"></i>
        {{ isLoading ? 'Loading...' : 'Refresh Data' }}
      </button>
      <button class="download-btn" (click)="downloadPayslipPdf()" [disabled]="isDownloading || !payslipRecords.length">
        <i class="fas fa-download download-icon" [class.spinning]="isDownloading"></i>
        {{ isDownloading ? 'Downloading...' : 'Download PDF' }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && payslipRecords.length === 0" class="loading-container">
    <div class="loading-spinner">
      <i class="fas fa-spinner"></i>
    </div>
    <p>Loading your payroll information...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <div class="error-card">
      <i class="fas fa-exclamation-triangle error-icon"></i>
      <h3>Unable to Load Payroll Data</h3>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="refreshPayData()">
        <i class="fas fa-redo"></i>
        Try Again
      </button>
    </div>
  </div>

  <!-- Success Message for PDF Download -->
  <div *ngIf="downloadSuccess" class="success-container">
    <div class="success-card">
      <i class="fas fa-check-circle success-icon"></i>
      <h3>PDF Downloaded Successfully</h3>
      <p>Your payslip has been downloaded to your device.</p>
    </div>
  </div>

  <!-- Payroll Content -->
  <div *ngIf="payslipRecords.length > 0 && !isLoading" class="pay-content">
    
    <!-- Summary Statistics -->
    <div class="stats-section">
      <h3>
        <i class="fas fa-chart-bar stats-icon"></i>
        Payroll Summary
      </h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-receipt"></i>
          </div>
          <div class="stat-content">
            <h4>{{ payslipRecords.length }}</h4>
            <p>Total Records</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-coins"></i>
          </div>
          <div class="stat-content">
            <h4>{{ getTotalAmount() }}</h4>
            <p>Total Amount</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-content">
            <h4>{{ getTotalWorkingHours() }}</h4>
            <p>Working Hours</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-building"></i>
          </div>
          <div class="stat-content">
            <h4>{{ getUniqueCompanies() }}</h4>
            <p>Companies</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Employee Information Card -->
    <div class="employee-info-section">
      <h3>
        <i class="fas fa-user-tie info-icon"></i>
        Employee Information
      </h3>
      <div class="info-card" *ngIf="payslipRecords[0]">
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Employee ID</span>
            <span class="info-value employee-id">{{ payslipRecords[0].employeeId }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Full Name</span>
            <span class="info-value">{{ payslipRecords[0].name || 'Not Available' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Position</span>
            <span class="info-value position">{{ payslipRecords[0].position || 'Not Available' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Gender</span>
            <span class="info-value">{{ payslipRecords[0].gender || 'Not Available' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Date of Birth</span>
            <span class="info-value">{{ formatDate(payslipRecords[0].dateOfBirth) }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Nationality</span>
            <span class="info-value">{{ payslipRecords[0].nationality || 'Not Available' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Payslip Records Table -->
    <div class="payslip-records-section">
      <div class="section-header">
        <h3>
          <i class="fas fa-table records-icon"></i>
          Detailed Payslip Records
        </h3>
        <div class="record-count">
          {{ payslipRecords.length }} record{{ payslipRecords.length !== 1 ? 's' : '' }} found
        </div>
      </div>

      <div class="table-container">
        <div class="table-wrapper">
          <table class="payslip-table">
            <thead>
              <tr>
                <th><i class="fas fa-building"></i> Company</th>
                <th><i class="fas fa-sitemap"></i> Cost Center</th>
                <th><i class="fas fa-layer-group"></i> Pay Scale</th>
                <th><i class="fas fa-coins"></i> Amount</th>
                <th><i class="fas fa-tag"></i> Wage Type</th>
                <th><i class="fas fa-clock"></i> Hours</th>
                <th><i class="fas fa-money-bill"></i> Currency</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let record of payslipRecords; trackBy: trackByRecord" class="payslip-row">
                <td>
                  <div class="company-cell">
                    <span class="company-code">{{ getCompanyDescription(record.companyCode) }}</span>
                  </div>
                </td>
                <td>
                  <div class="cost-center-cell">
                    <span class="cost-center">{{ record.costCenter || 'N/A' }}</span>
                  </div>
                </td>
                <td>
                  <div class="pay-scale-cell">
                    <div class="pay-scale-group">
                      <span class="scale-label">Group:</span>
                      <span class="scale-value">{{ record.payScaleGroup || 'N/A' }}</span>
                    </div>
                    <div class="pay-scale-level">
                      <span class="scale-label">Level:</span>
                      <span class="scale-value">{{ record.payScaleLevel || 'N/A' }}</span>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="amount-cell">
                    <span class="amount-badge">{{ formatAmount(record.amount, record.currency) }}</span>
                  </div>
                </td>
                <td>
                  <div class="wage-type-cell">
                    <span class="wage-type-badge">{{ record.wageType || 'N/A' }}</span>
                  </div>
                </td>
                <td>
                  <div class="hours-cell">
                    <span class="hours-badge">
                      <i class="fas fa-clock"></i>
                      {{ record.workingHours || '0' }}h
                    </span>
                  </div>
                </td>
                <td>
                  <div class="currency-cell">
                    <span class="currency-badge">{{ record.currency || 'N/A' }}</span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- No Records State -->
    <div *ngIf="payslipRecords.length === 0 && !isLoading && !error" class="no-records">
      <div class="no-records-card">
        <i class="fas fa-inbox no-records-icon"></i>
        <h3>No Payslip Records Found</h3>
        <p>There are currently no payslip records available for your employee ID.</p>
        <button class="refresh-btn" (click)="refreshPayData()">
          <i class="fas fa-sync-alt"></i>
          Refresh Data
        </button>
      </div>
    </div>
  </div>
</div>
